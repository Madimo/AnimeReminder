<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>新番提醒 | Anime Reminder | 第三方免费动漫更新提醒</title>
    <link href="./static/css/style.css" rel="stylesheet">
    <script src="./static/js/jquery.js"></script>
    <script src="./static/js/carousel.js"></script>
    <script type="text/javascript">
        var indexControl = {
            _this: this,
            returnData: {},
            checkData: function(data, callback) {
                callback(data.status == 200?data.data:false);
            },
            getData: function(url, callback, errortag) {
                var _this = this;
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json",
                    success: function(data){
                        _this.checkData(data, callback);
                    },
                    error: function() {
                        //_this.checkData(_this.returnData, callback);
                        $(errortag).html("<p style='display:block;margin:0 auto;text-align:center'>您的浏览器不支持Ajax</p>");
                    }
                })
            },
            indexHander: function(updateData) {
                var animeImageUrl = 'http://images.movie.xunlei.com/submovie_img/';
                var animeUrl = 'http://data.movie.kankan.com/movie/';
                var ul = $(".main-update-container");
                var j = 0;
                if (updateData) {
                    for (i=0;i<updateData.length;i++) {
                        if (i == updateData.length / 2) 
                            j = 1;
                        var m = updateData[i].animeid;
                        var url = animeImageUrl+m[0]+m[1]+'/'+m+'/'+updateData[i].episode+'_1_115x70.jpg';
                        $('<li class="main-update-item"><img class="update-img" src="'+url+'" onerror=this.src="./static/img/ar.jpg" /><p class="update-title"><a href="'+animeUrl+updateData[i].animeid+'">'+updateData[i].name+'</a></p><p class="update-title">更新到 <span class="episode">'+updateData[i].episode+'</span> 集</p></li>').appendTo(ul[j]);
                    };
                };
                $(".update-load").hide();
                setInterval(function(){carousel.next()}, 10000);
            },
            scheduleHandler: function(updateData) {
                var animeImageUrl = 'http://images.movie.xunlei.com/submovie_img/';
                if (updateData) {
                    for (i=0;i<updateData.length;i++) {
                        var m = updateData[i].url.split('/')[4];
                        var url = animeImageUrl+m[0]+m[1]+'/'+m+'/'+'1_1_115x70.jpg';
                        $('<li class="update-schedule-item"><img class="update-img" src="'+url+'" onerror=this.src="./static/img/ar.jpg" /><p class="update-title"><a href="'+updateData[i].url+'">'+updateData[i].name+'</a></p><p class="update-title">'+updateData[i].time+' 更新</p></li>').appendTo($(".update-schdele-container")[updateData[i].week]);
                    }
                }
                $('<a class="carousel-control" href="#prev" data-slide="prev">‹</a><a class="carousel-control control-right" href="#next" data-slide="next">›</a>').appendTo($(".main-schedule-container"));
                $(".carousel-control").click(function(){carousel[this.attributes[2].value]();})
                $(".weekday").show();
                $(".schedule-load").hide();
            },
            loginHandler: function() {
                var loginUrl = '/login';
                $.ajax({
                    type: "POST",
                    url: loginUrl,
                    data: '',
                    dataType: "json",
                    success: function(data){
                        if (data.status != 200) {
                            $(".login-error").text(data.message);
                            $(".login-error").show();
                        } else {
                            //跳转个人主页
                        }
                    },
                    error: function() {
                        $(".login-error").text("登录失败QAQ!");
                        $(".login-error").show();
                    }
                })
            }
        }

        $(function(){
            indexControl.getData('/index', indexControl.indexHander, ".main-update-ul-container");
            indexControl.getData('/get_update_schedule', indexControl.scheduleHandler, ".main-schedule-container");
            $(".button").click(function(){indexControl[this.attributes[1].value]()})
        });
    </script>
</head>

<body>
    <div class="header">
        <img class="header-img" src="./static/img/2013-12-29.jpg">
    </div>
    <div class="main">
        <h1 class="header-title">新番提醒</h1>
        <div class="main-intro">
            <div class="hr-line"></div>
            <ul class="main-w-container">
                <li class="main-w">
                    <img class="main-w-img" src="./static/img/w/w2.jpg">
                    <p class="main-w-text">京骚戏画更新了！诶什么时候更新的？用新番提醒，更新了直接邮件提醒。当然，如果你是Email控的话...</p>
                </li>
                <li class="main-w">
                    <img class="main-w-img" src="./static/img/w/w1.jpg">
                    <p class="main-w-text">啊咧，我的约炮大作战（雾）看到多少集了呢>.<，新番提醒给你记录啦，这样又能追番又能记录~妈妈再也不担心~</p>
                </li>
                <li class="main-w">
                    <img class="main-w-img" src="./static/img/w/w3.jpg">
                    <p class="main-w-text">明天更新啥动漫..中二病第二季快出来了呢..嗯，给你今天和明天的更新表，把握好时机把骚年！23333333~</p>
                </li>
            </ul>
            <div class="hr-line"></div>
        </div>
        <div class="main-update">
            <p class="main-update-intro">嘛嘛，这几天有什么动漫更新了呢...</p>
            <div class="main-update-ul-container">
                <img class="load update-load" src="./static/img/01.gif" />
                <ul class="main-update-container"></ul>
                <ul class="main-update-container"></ul>
            </div>
        </div>
        <div class="hr-line"></div>
        <div class="main-schedule">
            <p class="main-schedule-intro"><span class="weekday">星期天</span>...实际上还有更详细的时间表</p>
            <div class="main-schedule-container">
                <img class="load schedule-load" src="./static/img/01.gif" />
                <ul class="w30">
                    <li class="main-schedule-item active"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item left"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item"><ul class="update-schdele-container"></ul></li>
                    <li class="main-schedule-item next"><ul class="update-schdele-container"></ul></li>
                </ul>
            </div>
        </div>
        <div class="hr-line"></div>
        <div class="reg-login">
            <p class="main-add">だ·か·ら</p>
            <p class="main-add-intro">快注册个新番提醒账号吧~还有WP、Android、iOS的客户端哦~</p>
            <div class="reg-login-container">
                <form class="form reg">
                    <p class="main-add-intro white">我要注册>A<</p>
                    <input type="text" name="email" placeholder="邮箱"/>
                    <input type="password" name="password" placeholder="密码" />
                    <input type="password" name="password2" placeholder="密码确认" />
                    <p class="button" data-type="regHandler">点我注册>////<</p>
                    <p class="error reg-error"></p>
                </form>
                <form class="form login">
                    <p class="main-add-intro white">直接登录=w=</p>
                    <input type="text" name="email" placeholder="邮箱"/>
                    <input type="password" name="password" placeholder="密码" />
                    <p class="button" data-type="loginHandler">点我登录Q^Q</p>
                    <p class="error login-error"></p>
                </form>
            </div>
        </div>
        <div class="hr-line"></div>
    </div>
    <div class="footer">
        <p class="copyright">
            Copyright ©2013 
            <a href="http://ricter.info">Ricter</a>
            Powered By
            <a href="http://github.com/RicterZ/AnimeReminder">新番提醒</a>
        </p>
    </div>
</body>
</html>